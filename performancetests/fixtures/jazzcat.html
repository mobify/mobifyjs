<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<script>
(function(window, document, detector, mobifyjsUrl, mainUrl) {

// Start Mobify object with initial timestamp when loaded.
// Uncomment when needed for performance testing.
window.Mobify = {points: [+new Date]};

// if mobify=(1|0) override is set in hash or cookie, force mobify on/off.
var override = /((; )|#|&|^)mobify=(\d)/.exec(location.hash + '; ' + document.cookie);
if (override && override[3]) {
    // if mobify=0, do not run mobify.
    if (!+override[3]) return;
}
// else do not run mobify if Mobify object exists, or detector fails.
else if (this.Mobify || !detector()) {
    return;
}

function attachScriptBeforeMobifyTag(script, src, id, classNames) {
    var mobifyTagScript = document.getElementsByTagName('script')[0];

    script.src = src;
    script.id = id;
    script.setAttribute("class", classNames);
    mobifyTagScript.parentNode.insertBefore(script, mobifyTagScript);
}

document.write('<plaintext style="display:none">');

// On next tick, load library and main executable
setTimeout(function() {
    var Mobify = window.Mobify = window.Mobify || {};
    Mobify.capturing = true;
    var mobifyjsScript = document.createElement('script');
    var errorHandler = function() {
        var now = new Date();
        // Set now to 30 minutes ahead
        now.setTime(now.getTime() + 1800000);
        document.cookie = 'mobify=0' +
                '; expires=' + now.toGMTString() +
                '; path=/';
        // Reload the page (location.reload has problems in FF)
        window.location = window.location.href;
    };
    mobifyjsScript.onload = function(){
        if (mainUrl) {
            var mainScript = document.createElement('script');
            mainScript.onerror = errorHandler;
            attachScriptBeforeMobifyTag(mainScript, mainUrl, "mobify-js-main", "mobify");
        }
    };
    mobifyjsScript.onerror = errorHandler;
    attachScriptBeforeMobifyTag(mobifyjsScript, mobifyjsUrl, "mobify-js", "mobify");

});

})( window, document,
    // detector function
    function (){
        // We're enabled for:
        // - WebKit based browsers
        // - IE 10
        // - FireFox 4+
        // - Opera 11+
        // - 3DS
        var match = /webkit|msie\s10|(firefox)[\/\s](\d+)|(opera)[\s\S]*version[\/\s](\d+)|3ds/i.exec(navigator.userAgent);
     
        if (!match) {
            return false;
        }
     
        // match[1] == Firefox
        if (match[1] && +match[2] < 4) {
            return false;
        }
        // match[3] == Opera
        if (match[3] && +match[4] < 11) {
            return false;
        }

        return true;
    },

    // path to mobify.js
    '/mobifyjs/performancetests/resources/mobify-main-jazzcat.min.js'
);
</script>
<script>
window.onload = function() {
    // Grab the total time since starting capturing and send it
    // to the parent for testing in performance.html
    var end = +new Date;
    var begin;
    if (window.Mobify && window.Mobify.points) {
        begin = window.Mobify.points[0];
    } else {
        var pointEl = document.getElementById("mobify-point");
        if (pointEl) {
            begin = pointEl.innerText || pointEl.textContent;
        }
    }
    var diff = end - begin;
    alert("onload time: " + diff);
    // Cleanup cache
    localStorage.removeItem("Mobify-Combo-Cache-v1.0");
    // Send data to parent;
    parent.postMessage(diff, "*");
}
</script>
<!-- END MOBIFY TAG -->
<link rel="stylesheet" href="/mobifyjs/examples/assets/css/stylesheet.css" type="text/css">
<title>Performance Fixture for Jazzcat</title>
</head>
<body class="foo">

<script src="http://code.jquery.com/jquery-2.0.2.min.js"></script>
<!--<script>
console.log("I should appear before logging onload!");
setTimeout(function(){
    console.log("I should appear after logging onload!");
},0);
</script>-->
</body>
</html>
